#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# LAYER 5: PRE-COMMIT VALIDATION
# Physically REJECTS commits that violate quality standards

echo "ğŸ” Running pre-commit validation..."

# Layer 1: File Structure
echo "â†’ Validating file structure..."
npm run validate:structure || {
  echo "âŒ File structure violations detected"
  echo "   Fix violations before committing"
  exit 1
}

# Layer 2: ESLint
echo "â†’ Running ESLint..."
npx lint-staged || {
  echo "âŒ ESLint errors detected"
  echo "   Fix linting errors before committing"
  exit 1
}

# Layer 3 & 4: TypeScript + Tests (run on staged files)
echo "â†’ Type checking..."
npm run typecheck || {
  echo "âŒ TypeScript errors detected"
  echo "   Fix type errors before committing"
  exit 1
}

echo "âœ… All validation passed - commit allowed"
